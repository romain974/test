<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cesium AR</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.85/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.85/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
      #cesiumContainer {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      #video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div id="cesiumContainer"></div>
    <video id="video" autoplay playsinline muted></video>
    <script>
      // Créer une instance de Cesium Viewer
      const viewer = new Cesium.Viewer("cesiumContainer", {
        baseLayerPicker: false,
        geocoder: false,
        homeButton: false,
        infoBox: false,
        sceneModePicker: false,
        timeline: false,
        navigationHelpButton: false,
        fullscreenButton: false,
        scene3DOnly: true,
        shouldAnimate: true,
        terrainProvider: Cesium.createWorldTerrain(),
        contextOptions: {
          webgl: {
            alpha: true,
          },
        },
      });

      // Définir la transparence du globe
      viewer.scene.globe.enableLighting = true;
      viewer.scene.globe.transparent = true;

      // Ajouter un marqueur aux coordonnées spécifiées
      const entity = viewer.entities.add({
        position: Cesium.Cartesian3.fromDegrees(55.343199, -20.926952),
        point: {
          color: Cesium.Color.RED,
          pixelSize: 10,
        },
      });

      // Accéder à la caméra de l'appareil
      navigator.mediaDevices
        .getUserMedia({ video: { facingMode: "environment" } })
        .then((stream) => {
          // Attacher le flux vidéo à l'élément vidéo
          const video = document.getElementById("video");
          video.srcObject = stream;
          video.play();

          // Mettre à jour la position de la caméra en fonction de la vidéo
          function updateCamera() {
            const position = Cesium.Cartesian3.fromDegrees(
              video.videoWidth / 2,
              video.videoHeight / 2,
              0
            );
            const orientation = Cesium.Transforms.headingPitchRollQuaternion(
              position,
              new Cesium.HeadingPitchRoll(
                Cesium.Math.toRadians(90),
                Cesium.Math.toRadians(90),
                0
              )
            );
            viewer.camera.setView({
              destination: position,
              orientation: orientation,
            });
          }

          // Mettre à jour la position de la caméra toutes les 100 ms
          setInterval(updateCamera, 100);
        })
        .catch((error) => {
          console.error("Erreur d'accès à la caméra :", error);
        });
    </script>
  </body>
</html>
